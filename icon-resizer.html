<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Icon Resizer & Renamer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #f0f2f5; margin: 0; }
        #drop-zone {
            width: 450px; height: 250px; border: 3px dashed #cbd5e0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 15px; color: #4a5568; transition: all 0.3s ease; background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; padding: 20px;
        }
        #drop-zone.hover { border-color: #4299e1; background: #ebf8ff; transform: scale(1.02); }
        #status { margin-top: 25px; font-weight: 600; color: #2d3748; }
        .info { font-size: 0.9em; color: #718096; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>LSTM Icon Processor</h2>
    <div id="drop-zone">
        <div><strong>Drop PNG icons here</strong></div>
        <div class="info">Output: 160x160px (25px padding)<br>Format: lstm-icon-[random].png</div>
    </div>
    <div id="status">Ready</div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const status = document.getElementById('status');

        // Helper: Generate 5 random alphanumeric characters
        function generateRandomString(length) {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, e => e.preventDefault(), false);
        });

        dropZone.addEventListener('dragover', () => dropZone.classList.add('hover'));
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('hover'));

        dropZone.addEventListener('drop', async (e) => {
            dropZone.classList.remove('hover');
            const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'image/png');
            
            if (files.length === 0) {
                status.innerText = "Error: Please drop PNG files.";
                return;
            }

            status.innerText = `Processing ${files.length} icons...`;
            const zip = new JSZip();
            
            for (const file of files) {
                const processedBlob = await processImage(file);
                // Create the new name: lstm-icon-xxxxx.png
                const newFileName = `lstm-icon-${generateRandomString(5)}.png`;
                zip.file(newFileName, processedBlob);
            }

            status.innerText = "Zipping files...";
            const content = await zip.generateAsync({type: "blob"});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = `icons_batch_${Date.now()}.zip`;
            link.click();
            
            status.innerText = "Complete! Zip downloaded.";
        });

        async function processImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const targetSize = 160;
                        const padding = 25;
                        const iconSize = targetSize - (padding * 2);

                        // --- High Quality Scaling Logic ---
                        let tempCanvas = document.createElement('canvas');
                        let tempCtx = tempCanvas.getContext('2d');
                        
                        let width = img.width;
                        let height = img.height;
                        
                        tempCanvas.width = width;
                        tempCanvas.height = height;
                        tempCtx.drawImage(img, 0, 0, width, height);

                        // Step-down scaling for anti-aliasing
                        while (width > iconSize * 2) {
                            width /= 2;
                            height /= 2;
                            const nextCanvas = document.createElement('canvas');
                            nextCanvas.width = width;
                            nextCanvas.height = height;
                            const nextCtx = nextCanvas.getContext('2d');
                            nextCtx.imageSmoothingEnabled = true;
                            nextCtx.imageSmoothingQuality = 'high';
                            nextCtx.drawImage(tempCanvas, 0, 0, width, height);
                            tempCanvas = nextCanvas;
                        }

                        // Final Canvas Assembly
                        const finalCanvas = document.createElement('canvas');
                        const finalCtx = finalCanvas.getContext('2d');
                        finalCanvas.width = targetSize;
                        finalCanvas.height = targetSize;

                        finalCtx.imageSmoothingEnabled = true;
                        finalCtx.imageSmoothingQuality = 'high';

                        // Center the icon within the 160x160 canvas
                        finalCtx.drawImage(tempCanvas, padding, padding, iconSize, iconSize);

                        finalCanvas.toBlob((blob) => resolve(blob), 'image/png');
                    };
                };
            });
        }
    </script>
</body>
</html>